import{d as x,i as S,z as e,b as I,q as f,g as i,h as y,c as T}from"./q-BrAWZM5D.js";import{_ as v}from"./q-DoNi8vyY.js";import{M as J}from"./q-CpaBcVLh.js";import{R as z}from"./q-CxvojXWr.js";import{g as F}from"./q-8SE1YrZV.js";import{u as L}from"./q-CLNnGxoW.js";import{p as j}from"./q-CVtgbu2y.js";import{p as E}from"./q-C2EB_Z9y.js";const D=()=>{const[n]=x();n.value=!1},N=Object.freeze(Object.defineProperty({__proto__:null,_hW:T,s_eSzeQXAnEgA:D},Symbol.toStringTag,{value:"Module"})),C=()=>{const[n]=x();return n("/gestione/bacheca")},R=Object.freeze(Object.defineProperty({__proto__:null,s_0CSBNJNbywo:C},Symbol.toStringTag,{value:"Module"})),V=n=>{const[s,d,c]=x();c.value=n,s.value=`/media/${n}`,d.value=!1;const a=document.querySelector('input[name="immagine_principale"]');a&&(a.value="")},q=Object.freeze(Object.defineProperty({__proto__:null,_hW:T,s_wl1CxUJTVyE:V},Symbol.toStringTag,{value:"Module"})),B=()=>{const[n]=x();return n.value=!0},U=Object.freeze(Object.defineProperty({__proto__:null,s_9GdzDqKyl4U:B},Symbol.toStringTag,{value:"Module"})),G=n=>{var A,m,w,k,_,b;const s=L(),d=S(!1),c=S(null),a=S(null),r=S(!1),o=S(null),p=f(()=>v(()=>Promise.resolve().then(()=>K),void 0),"s_GS3F4hFhyYw",[c,d,n,o]),h=f(()=>v(()=>Promise.resolve().then(()=>X),void 0),"s_qNLcIIi0zsQ",[c,a,o]),g=f(()=>v(()=>Promise.resolve().then(()=>q),void 0),"s_wl1CxUJTVyE",[a,r,o]);return e("div",null,{class:"max-w-5xl mx-auto"},[e("form",null,{id:"post-form","preventdefault:submit":!0,class:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700",onSubmit$:p},[c.value&&e("div",null,{class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-800 rounded-2xl text-red-600 dark:text-red-400 font-bold flex items-center gap-3"},[e("span",null,null,"âš ï¸",3,null),i(l=>l.value,[c])],3,"hJ_0"),e("div",null,{class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},[e("div",null,{class:"lg:col-span-2 space-y-6"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Titolo della News",3,null),e("input",null,{type:"text",name:"titolo",required:!0,value:i(l=>{var t;return(t=l.post)==null?void 0:t.titolo},[n]),placeholder:"es. Stage Tecnico di Primavera",class:"w-full px-6 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-black uppercase tracking-tight"},null,3,null)],3,null),e("div",null,{class:"grid grid-cols-1 md:grid-cols-2 gap-4"},[e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"AttivitÃ ",3,null),e("select",null,{name:"tags",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},[e("option",null,{value:"",selected:i(l=>{var t;return!((t=l.post)!=null&&t.tags)},[n])},"Generale",3,null),e("option",null,{value:"JUDO",selected:i(l=>{var t;return((t=l.post)==null?void 0:t.tags)==="JUDO"},[n])},"Judo",3,null),e("option",null,{value:"BJJ",selected:i(l=>{var t;return((t=l.post)==null?void 0:t.tags)==="BJJ"},[n])},"BJJ",3,null),e("option",null,{value:"JJ",selected:i(l=>{var t;return((t=l.post)==null?void 0:t.tags)==="JJ"},[n])},"JJ",3,null),e("option",null,{value:"KRAV MAGA",selected:i(l=>{var t;return((t=l.post)==null?void 0:t.tags)==="KRAV MAGA"},[n])},"Krav Maga",3,null)],3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Data Pubblicazione",3,null),e("input",null,{type:"datetime-local",name:"data_riferimento",required:!0,value:i(l=>{var t;return typeof((t=l.post)==null?void 0:t.data_riferimento)=="string"?l.post.data_riferimento.substring(0,16).replace(" ","T"):new Date().toISOString().substring(0,16)},[n]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Contenuto",3,null),I(z,{name:"contenuto",id:"contenuto",get value(){var l;return(l=n.post)==null?void 0:l.contenuto},placeholder:"Scrivi qui la news...",[y]:{name:y,id:y,value:i(l=>{var t;return(t=l.post)==null?void 0:t.contenuto},[n]),placeholder:y}},3,"hJ_1")],1,null)],1,null),e("div",null,{class:"space-y-6"},[e("div",null,{class:"space-y-4"},[e("div",null,{class:"flex items-center justify-between px-1"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest"},"Immagine di Copertina",3,null),e("button",null,{type:"button",class:"text-[10px] font-black text-orange-600 uppercase tracking-widest hover:underline",onClick$:f(()=>v(()=>Promise.resolve().then(()=>U),void 0),"s_9GdzDqKyl4U",[r])},"Sfoglia Libreria",3,null)],3,null),e("div",null,{class:"relative group aspect-video rounded-3xl overflow-hidden bg-gray-100 dark:bg-gray-800 border-2 border-dashed border-gray-200 dark:border-gray-700"},[a.value||(A=n.post)!=null&&A.immagine_principale&&!n.isNew?e("img",{src:a.value||((w=(m=n.post)==null?void 0:m.immagine_principale)!=null&&w.startsWith("media/")?"/"+n.post.immagine_principale:F((k=n.post)==null?void 0:k.collectionId,(_=n.post)==null?void 0:_.id,(b=n.post)==null?void 0:b.immagine_principale))},{alt:"Preview",class:"w-full h-full object-cover",onError$:f(()=>v(()=>import("./q-L94jJj65.js"),[]),"s_hKAXb54Ltak")},null,3,"hJ_2"):e("div",null,{class:"w-full h-full flex flex-col items-center justify-center text-gray-400"},[e("span",null,{class:"text-4xl mb-2"},"ðŸ–¼ï¸",3,null),e("span",null,{class:"text-[10px] font-black uppercase tracking-widest"},"Seleziona Immagine",3,null)],3,null),e("input",null,{type:"file",name:"immagine_principale",accept:"image/*",class:"absolute inset-0 opacity-0 cursor-pointer",onInput$:h},null,3,null)],1,null)],1,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Video Link (YouTube o URL)",3,null),e("input",null,{type:"text",name:"video_link",value:i(l=>{var t;return(t=l.post)==null?void 0:t.video_link},[n]),placeholder:"es. https://youtu.be/...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-medium"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Link Esterno (Opzionale)",3,null),e("input",null,{type:"text",name:"link_esterno",value:i(l=>{var t;return(t=l.post)==null?void 0:t.link_esterno},[n]),placeholder:"es. https://fijlkam.it/gara...",class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-medium"},null,3,null)],3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-xs font-black text-gray-400 uppercase tracking-widest px-1"},"Data Scadenza (Auto-archiviazione)",3,null),e("input",null,{type:"datetime-local",name:"data_fine",value:i(l=>{var t;return typeof((t=l.post)==null?void 0:t.data_fine)=="string"?l.post.data_fine.substring(0,16).replace(" ","T"):""},[n]),class:"w-full px-5 py-4 rounded-2xl bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 focus:ring-4 focus:ring-orange-500/10 focus:border-orange-500 outline-none transition-all dark:text-white font-bold"},null,3,null)],3,null)],1,null)],1,null),e("div",null,{class:"pt-10 border-t border-gray-100 dark:border-gray-800 flex justify-end gap-4"},[e("button",null,{type:"button",class:"px-8 py-4 rounded-2xl font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all",onClick$:f(()=>v(()=>Promise.resolve().then(()=>R),void 0),"s_0CSBNJNbywo",[s])},"Annulla",3,null),e("button",null,{type:"button",disabled:i(l=>l.value,[d]),class:"px-10 py-4 rounded-2xl bg-orange-600 text-white font-black text-lg shadow-xl shadow-orange-500/20 hover:transform hover:-translate-y-1 transition-all disabled:opacity-50",onClick$:p},i((l,t)=>l.value?"In corso...":t.isNew?"Pubblica News":"Salva Modifiche",[d,n]),3,null)],3,null)],1,null),I(J,{get isOpen(){return r.value},onClose:f(()=>v(()=>Promise.resolve().then(()=>N),void 0),"s_eSzeQXAnEgA",[r]),onSelect:g,[y]:{isOpen:i(l=>l.value,[r]),onSelect:y}},3,"hJ_3")],1,"hJ_4")},oe=Object.freeze(Object.defineProperty({__proto__:null,s_0J3LsTZOlIw:G},Symbol.toStringTag,{value:"Module"})),$=async()=>{var l,t;const[n,s,d,c]=x();console.log("[Admin] Form SUBMIT triggered"),s.value=!0,n.value=null;const a=document.getElementById("post-form");if(!a){alert("Errore: Form non trovato nel DOM"),s.value=!1;return}const r=new FormData(a),o=new FormData,p=(l=r.get("titolo"))==null?void 0:l.trim();if(!p){alert("Il campo TITOLO Ã¨ obbligatorio."),s.value=!1;return}o.append("titolo",p);const h=u=>(u||"untitled").toLowerCase().replace(/[Ã Ã¡Ã¢Ã£Ã¤Ã¥]/g,"a").replace(/[Ã¨Ã©ÃªÃ«]/g,"e").replace(/[Ã¬Ã­Ã®Ã¯]/g,"i").replace(/[Ã²Ã³Ã´ÃµÃ¶]/g,"o").replace(/[Ã¹ÃºÃ»Ã¼]/g,"u").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100);o.append("slug",h(p));const g=r.get("contenuto");console.log("[Admin] Sending content:",g),o.append("contenuto",g||"");const A=r.get("tags");o.append("tags",A||"GENERALE");let m=r.get("data_riferimento");if(m&&m.includes("T")&&(m=m.replace("T"," ")+":00"),!m){alert("Il campo DATA Ã¨ obbligatorio."),s.value=!1;return}o.append("data_riferimento",m);const w=r.get("video_link");w&&o.append("video_link",w);const k=r.get("link_esterno");k&&o.append("link_esterno",k);let _=r.get("data_fine");_&&_.includes("T")&&(_=_.replace("T"," ")+":00",o.append("data_fine",_));const b=a.querySelector('input[name="immagine_principale"]');if((t=b==null?void 0:b.files)!=null&&t[0])console.log("[Admin] Adding new cover image:",b.files[0].name),o.append("immagine_principale",b.files[0]);else if(c.value){console.log("[Admin] Attaching existing media:",c.value);try{const O=await(await fetch(`/media/${c.value}`)).blob(),M=new File([O],c.value,{type:O.type});o.append("immagine_principale",M)}catch(u){console.error("[Admin] Error attaching media file:",u)}}if(!E.authStore.isValid){alert("Attenzione: Sessione non valida. Effettua nuovamente il login."),s.value=!1;return}try{if(d.isNew){await E.collection("bacheca").create(o);try{const u=(g==null?void 0:g.replace(/<[^>]*>/g,""))||"",O=u.length>150?u.substring(0,150)+"...":u,P=await(await fetch("/api/email/post-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:p,author:"Admin",excerpt:O||"Nessun contenuto disponibile"})})).json();P.success?console.log("[PostForm] âœ‰ï¸ Email notification sent successfully"):console.warn("[PostForm] âš ï¸ Email notification failed:",P.error)}catch(u){console.error("[PostForm] âš ï¸ Error sending email notification:",u)}}else await E.collection("bacheca").update(d.post.id,o);window.location.href="/gestione/bacheca"}catch(u){n.value=j(u),window.scrollTo({top:0,behavior:"smooth"})}finally{s.value=!1}},K=Object.freeze(Object.defineProperty({__proto__:null,_hW:T,s_GS3F4hFhyYw:$},Symbol.toStringTag,{value:"Module"})),Q=n=>{const[s,d,c]=x(),a=n.target;if(a.files&&a.files[0]){const r=a.files[0];if(r.size>5242880){s.value="L'immagine Ã¨ troppo grande. Il limite Ã¨ 5MB.",a.value="",d.value=null,window.scrollTo({top:0,behavior:"smooth"});return}s.value=null,c.value=null;const p=new FileReader;p.onload=h=>{var g;d.value=(g=h.target)==null?void 0:g.result},p.readAsDataURL(r)}},X=Object.freeze(Object.defineProperty({__proto__:null,_hW:T,s_qNLcIIi0zsQ:Q},Symbol.toStringTag,{value:"Module"}));export{T as _hW,oe as p,C as s_0CSBNJNbywo,G as s_0J3LsTZOlIw,B as s_9GdzDqKyl4U,$ as s_GS3F4hFhyYw,D as s_eSzeQXAnEgA,Q as s_qNLcIIi0zsQ,V as s_wl1CxUJTVyE};
